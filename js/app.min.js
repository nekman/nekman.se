/*!
  nekman.se - http://github.com/nekman/nekman.se
*/

define("fontController",["webfont","jquery"],function(e,t){var n=new t.Deferred;return e.load({google:{families:["Cantarell","Droid+Serif","Lato:100:latin"]},active:function(){n.resolve()}}),{promise:n}}),define("twitterEntities",["jquery"],function(e){var t=function(t){return e("<div/>").text(t).html()},n=function(n){if(!n.entities)return t(n.text);var r={},i=function(e,t){r[e.indices[0]]=[e.indices[1],t]};e.each(n.entities.urls,function(e,n){i(n,function(e){return"<a href='"+t(n.url)+"'>"+t(e)+"</a>"})}),e.each(n.entities.hashtags,function(e,n){i(n,function(e){return"<a href='http://twitter.com/search?q="+escape("#"+n.text)+"'>"+t(e)+"</a>"})}),e.each(n.entities.user_mentions,function(e,n){i(n,function(e){return"<a title='"+t(n.name)+"' href='http://twitter.com/"+t(n.screen_name)+"'>"+t(e)+"</a>"})});var s,o="",u=0,a=0;for(a=0,s=n.text.length;a<s;++a){var f=r[a];if(f){var l=f[0],c=f[1];a>u&&(o+=t(n.text.substring(u,a))),o+=c(n.text.substring(a,l)),a=l-1,u=l}}return a>u&&(o+=t(n.text.substring(u,a))),o};return{linkify:n}}),define("twitterView",["jquery","underscore","backbone","twitterEntities"],function(e,t,n,r){return n.View.extend({el:"#tweets",render:function(){return this.$el.append(e("<div>").addClass("tweet").html(r.linkify(this.model))),this}})}),define("twitterController",["twitterView","jquery","underscore"],function(e,t,n){return{$el:t("<section>").attr({id:"tweets"}),promise:t.ajax({url:"http://api.twitter.com/1/statuses/user_timeline.json?screen_name=nekman&include_entities=true",dataType:"jsonp"}),render:function(){return this.$el.append(t("<h4>").text("Latest tweets")),t("#main").append(this.$el),this.promise.done(function(t){n.each(n.first(t,3),function(t){var n=new e({model:t});n.render()})}),this}}}),define("stackExchangeView",["jquery","underscore","backbone"],function(e,t,n){var r=t.template('<div class="answer"><b class="score <%= accepted ? "accepted" : "" %>"><%= score %></b><a href="http://stackoverflow.com/questions/<%= question_id %>/#<%= answer_id %>"><%= title %></a></div>');return n.View.extend({el:"#stackexchange",render:function(){return this.$el.append(r(this.model)),this}})}),define("stackExchangeController",["stackExchangeView","jquery","underscore"],function(e,t,n){return{$el:t("<section>").attr({id:"stackexchange"}),promise:t.ajax({url:"http://api.stackoverflow.com/1.1/users/141363/answers?pagesize=5",dataType:"jsonp",jsonp:"jsonp"}),render:function(){return this.$el.append(t("<h4>").text("Latest answers on stackoverflow")),t("#main").append(this.$el),this.promise.done(function(t){n.each(n.first(t.answers,5),function(t){var n=new e({model:t});n.render()})}),this}}}),define("boxView",["jquery","underscore","backbone"],function(e,t,n){var r=t.template("icon-<%= name %> icon-4x"),i=function(e){return r({name:e.toLowerCase()})};return n.View.extend({tagName:"div",className:"box",events:{click:"click",tap:"click"},render:function(){var t=this.model.attributes;return this.$el.css({backgroundColor:t.color}).append(e("<h4>").text(t.name)).append(e("<div>").addClass(i(t.icon||t.name))),this},click:function(){location.href=this.model.get("url")}})}),define("boxCollection",["underscore","backbone"],function(e,t){var n=t.Model.extend({}),r=t.Collection.extend({model:n,url:"data/social.json"});return new r}),define("boxController",["boxView","boxCollection","jquery","underscore"],function(e,t,n,r){var i=function(){this.promise=t.fetch(),this.$el=n("<section>").attr({id:"social"})},s=function(t){var n=new e({model:t});this.$el.append(n.render().el)};return i.prototype={constructor:i,render:function(){var e=this;return this.promise.done(function(){t.forEach(n.proxy(s,e))}),this}},new i}),define("controllers",["fontController","twitterController","stackExchangeController","boxController","underscore"],function(){var e=[require("fontController"),require("twitterController"),require("stackExchangeController"),require("boxController")],t=require("underscore");return{promises:t.map(e,function(e){return e.promise}),all:e,viewControllers:t.filter(e,function(e){return typeof e.render=="function"})}}),define("windowResizeHandler",["jquery"],function(e){var t=960,n=e(window),r,i=function(){var e=n.width();if(e<t){r.removeClass("defaultwidth").addClass("minwidth");return}r.hasClass("defaultwidth")||r.addClass("defaultwidth").removeClass("minwidth")};return{watch:function(t){if(!(t instanceof e))throw"expected jQuery node";r=t.addClass("defaultwidth"),n.on("resize",i).trigger("resize")}}}),define("mainController",["webfont","controllers","jquery","windowResizeHandler"],function(e,t,n,r){var i=!n.support.cssFloat,s=n("header"),o=n("<footer>").append(n("<span>").text("@nekman - 2013"));return $loading=n("<div>").append(n("<i>").addClass("icon-spinner icon-spin icon-4x")).append(" Loading content... "),MainController=function(){this.$el=n("#main").append($loading),n("div.ribbon")[i?"hide":"show"]();var e=s.add(this.$el);r.watch(e)},MainController.prototype={constructor:MainController,render:function(){var e=this.$el,r=function(){_.each(t.viewControllers,function(t){e.append(t.render().$el)}),$loading.hide(),s.show(),e.after(o)};n.when(t.promises).done(r)}},new MainController}),require.config({paths:{jquery:"https://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min",underscore:"https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.4.3/underscore-min",backbone:"https://cdnjs.cloudflare.com/ajax/libs/backbone.js/0.9.9/backbone-min",webfont:"https://ajax.googleapis.com/ajax/libs/webfont/1/webfont",boxView:"social/boxView",boxCollection:"social/boxCollection",boxController:"social/boxController",twitterController:"twitter/twitterController",twitterView:"twitter/twitterView",twitterEntities:"lib/twitterEntities",stackExchangeController:"stackexchange/stackExchangeController",stackExchangeView:"stackexchange/stackExchangeView",controllers:"controllers"},shim:{backbone:{deps:["jquery","underscore"],exports:"Backbone"},underscore:{exports:"_"},jquery:{exports:"jQuery"},webfont:{exports:"WebFont"}}}),require(["mainController"],function(e){e.render()}),define("app",function(){});