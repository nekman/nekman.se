/*!
  nekman.se - http://github.com/nekman/nekman.se
*/

define("fontController",["webfont","jquery"],function(e,t){var n=new t.Deferred;return e.load({google:{families:["Cantarell","Droid+Serif","Lato:100:latin"]},active:function(){n.resolve()}}),{promise:n}}),define("twitterView",["jquery","underscore","backbone"],function(e,t,n){return n.View.extend({el:"#tweets",render:function(){return this.$el.append(e("<div>").addClass("tweet").text(this.model.text)),this}})}),define("twitterController",["twitterView","jquery","underscore"],function(e,t,n){return{$el:t("<section>").attr({id:"tweets"}),promise:t.ajax({url:"http://api.twitter.com/1/statuses/user_timeline.json?screen_name=nekman&include_entities=true",dataType:"jsonp"}),render:function(){return this.$el.append(t("<h4>").text("Latest tweets")),t("#main").append(this.$el),this.promise.done(function(t){n.each(n.first(t,3),function(t){var n=new e({model:t});n.render()})}),this}}}),define("boxView",["jquery","underscore","backbone"],function(e,t,n){var r=t.template("icon-<%= name %> icon-4x"),i=function(e){return r({name:e.toLowerCase()})};return n.View.extend({tagName:"div",className:"box",events:{click:"click",tap:"click"},render:function(){var t=this.model.attributes;return this.$el.css({backgroundColor:t.color}).append(e("<h4>").text(t.name)).append(e("<div>").addClass(i(t.icon||t.name))),this},click:function(){location.href=this.model.get("url")}})}),define("boxCollection",["underscore","backbone"],function(e,t){var n=t.Model.extend({}),r=t.Collection.extend({model:n,url:"data/social.json"});return new r}),define("boxController",["boxView","boxCollection","jquery","underscore"],function(e,t,n,r){var i=function(){this.promise=t.fetch(),this.$el=n("<section>").attr({id:"social"})},s=function(t){var n=new e({model:t});this.$el.append(n.render().el)};return i.prototype={constructor:i,render:function(){var e=this;return this.promise.done(function(){t.forEach(n.proxy(s,e))}),this}},new i}),define("controllers",["fontController","twitterController","boxController"],function(){var e=[require("fontController"),require("twitterController"),require("boxController")];return{promises:_.map(e,function(e){return e.promise}),all:e,viewControllers:_.filter(e,function(e){return typeof e.render=="function"})}}),define("mainController",["webfont","controllers","jquery"],function(e,t,n){var r=960,i=n(window),s=n("h1"),o=n("<div>").append(n("<i>").addClass("icon-spinner icon-spin")).append(" Loading content... "),u=function(){this.$el=n("#main").addClass("defaultwidth").append(o)},a=function(){var e=i.width();if(e<r){this.$el.removeClass("defaultwidth").addClass("minwidth");return}this.$el.hasClass("defaultwidth")||this.$el.addClass("defaultwidth").removeClass("minwidth")};return u.prototype={constructor:u,render:function(){window.onresize=n.proxy(a,this),i.trigger("resize");var e=this.$el,r=function(){_.each(t.viewControllers,function(t){e.append(t.render().$el)}),o.hide(),s.show()};n.when(t.promises).done(r)}},new u}),require.config({paths:{jquery:"https://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min",underscore:"https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.4.3/underscore-min",backbone:"https://cdnjs.cloudflare.com/ajax/libs/backbone.js/0.9.9/backbone-min",webfont:"https://ajax.googleapis.com/ajax/libs/webfont/1/webfont",boxView:"social/boxView",boxCollection:"social/boxCollection",boxController:"social/boxController",twitterController:"twitter/twitterController",twitterView:"twitter/twitterView"},shim:{backbone:{deps:["jquery","underscore"],exports:"Backbone"},underscore:{exports:"_"},jquery:{exports:"jQuery"},webfont:{exports:"WebFont"}}}),require(["mainController"],function(e){e.render()}),define("app",function(){});