/*!
  nekman.se - http://github.com/nekman/nekman.se
*/

define("fontController",["webfont","jquery"],function(e,t){var n=new t.Deferred;return e.load({google:{families:["Cantarell","Droid+Serif","Lato:100:latin"]},active:function(){n.resolve()}}),{promise:n}}),define("twitterEntities",["jquery"],function(){var e=function(e){return $("<div/>").text(e).html()},t=function(t){if(!t.entities)return e(t.text);var n={},r=function(e,t){n[e.indices[0]]=[e.indices[1],t]};$.each(t.entities.urls,function(t,n){r(n,function(t){return"<a href='"+e(n.url)+"'>"+e(t)+"</a>"})}),$.each(t.entities.hashtags,function(t,n){r(n,function(t){return"<a href='http://twitter.com/search?q="+escape("#"+n.text)+"'>"+e(t)+"</a>"})}),$.each(t.entities.user_mentions,function(t,n){r(n,function(t){return"<a title='"+e(n.name)+"' href='http://twitter.com/"+e(n.screen_name)+"'>"+e(t)+"</a>"})});var i,s="",o=0,u=0;for(u=0,i=t.text.length;u<i;++u){var a=n[u];if(a){var f=a[0],l=a[1];u>o&&(s+=e(t.text.substring(o,u))),s+=l(t.text.substring(u,f)),u=f-1,o=f}}return u>o&&(s+=e(t.text.substring(o,u))),s};return{linkify:t}}),define("twitterView",["jquery","underscore","backbone","twitterEntities"],function(e,t,n,r){return n.View.extend({el:"#tweets",render:function(){return this.$el.append(e("<div>").addClass("tweet").html(r.linkify(this.model))),this}})}),define("twitterController",["twitterView","jquery","underscore"],function(e,t,n){return{$el:t("<section>").attr({id:"tweets"}),promise:t.ajax({url:"http://api.twitter.com/1/statuses/user_timeline.json?screen_name=nekman&include_entities=true",dataType:"jsonp"}),render:function(){return this.$el.append(t("<h4>").text("Latest tweets")),t("#main").append(this.$el),this.promise.done(function(t){n.each(n.first(t,3),function(t){var n=new e({model:t});n.render()})}),this}}}),define("stackExchangeView",["jquery","underscore","backbone"],function(e,t,n){var r=t.template('<div class="answer"><b class="score <%= accepted ? "accepted" : "" %>"><%= score %></b><a href="http://stackoverflow.com/questions/<%= question_id %>/#<%= answer_id %>"><%= title %></a></div>');return n.View.extend({el:"#stackexchange",render:function(){return this.$el.append(r(this.model)),this}})}),define("stackExchangeController",["stackExchangeView","jquery","underscore"],function(e,t,n){return{$el:t("<section>").attr({id:"stackexchange"}),promise:t.ajax({url:"http://api.stackoverflow.com/1.1/users/141363/answers?pagesize=5",dataType:"jsonp",jsonp:"jsonp"}),render:function(){return this.$el.append(t("<h4>").text("Latest answers on stackoverflow")),t("#main").append(this.$el),this.promise.done(function(t){n.each(n.first(t.answers,5),function(t){var n=new e({model:t});n.render()})}),this}}}),define("boxView",["jquery","underscore","backbone"],function(e,t,n){var r=t.template("icon-<%= name %> icon-4x"),i=function(e){return r({name:e.toLowerCase()})};return n.View.extend({tagName:"div",className:"box",events:{click:"click",tap:"click"},render:function(){var t=this.model.attributes;return this.$el.css({backgroundColor:t.color}).append(e("<h4>").text(t.name)).append(e("<div>").addClass(i(t.icon||t.name))),this},click:function(){location.href=this.model.get("url")}})}),define("boxCollection",["underscore","backbone"],function(e,t){var n=t.Model.extend({}),r=t.Collection.extend({model:n,url:"data/social.json"});return new r}),define("boxController",["boxView","boxCollection","jquery","underscore"],function(e,t,n,r){var i=function(){this.promise=t.fetch(),this.$el=n("<section>").attr({id:"social"})},s=function(t){var n=new e({model:t});this.$el.append(n.render().el)};return i.prototype={constructor:i,render:function(){var e=this;return this.promise.done(function(){t.forEach(n.proxy(s,e))}),this}},new i}),define("controllers",["fontController","twitterController","stackExchangeController","boxController"],function(){var e=[require("fontController"),require("twitterController"),require("stackExchangeController"),require("boxController")];return{promises:_.map(e,function(e){return e.promise}),all:e,viewControllers:_.filter(e,function(e){return typeof e.render=="function"})}}),define("mainController",["webfont","controllers","jquery"],function(e,t,n){var r=960,i=n(window),s=n("h1"),o=n("<div>").append(n("<i>").addClass("icon-spinner icon-spin")).append(" Loading content... "),u=function(){this.$el=n("#main").addClass("defaultwidth").append(o),this.$resizeNodes=n("header").addClass("defaultwidth").add(this.$el)},a=function(){var e=i.width();if(e<r){this.$resizeNodes.removeClass("defaultwidth").addClass("minwidth");return}this.$resizeNodes.hasClass("defaultwidth")||this.$resizeNodes.addClass("defaultwidth").removeClass("minwidth")};return u.prototype={constructor:u,render:function(){window.onresize=n.proxy(a,this),i.trigger("resize");var e=this.$el,r=function(){_.each(t.viewControllers,function(t){e.append(t.render().$el)}),o.hide(),s.show()};n.when(t.promises).done(r)}},new u}),require.config({paths:{jquery:"https://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min",underscore:"https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.4.3/underscore-min",backbone:"https://cdnjs.cloudflare.com/ajax/libs/backbone.js/0.9.9/backbone-min",webfont:"https://ajax.googleapis.com/ajax/libs/webfont/1/webfont",boxView:"social/boxView",boxCollection:"social/boxCollection",boxController:"social/boxController",twitterController:"twitter/twitterController",twitterView:"twitter/twitterView",twitterEntities:"lib/twitterEntities",stackExchangeController:"stackexchange/stackExchangeController",stackExchangeView:"stackexchange/stackExchangeView"},shim:{backbone:{deps:["jquery","underscore"],exports:"Backbone"},underscore:{exports:"_"},jquery:{exports:"jQuery"},webfont:{exports:"WebFont"}}}),require(["mainController"],function(e){e.render()}),define("app",function(){});